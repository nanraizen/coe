$('a[href="#"]').click(function (e) {
    e.preventDefault();
});

$('img').each(function () {
    var img = $(this);
    var imgFile = img.attr('src').split('/').pop().split('.')[0];
    var imgAlt = img.attr('alt');

    if (!imgAlt) {
        img.attr('alt', imgFile);
    }
});

$(document).ready(function () {
    $('.backBtn').removeAttr('href').click(function () {
        window.history.back();
    });
});

// NAVBAR & FOOTER
$(window).scroll(function () {
    var scrollDistance = $(window).scrollTop();
    var navbar = $('.navbar-fix');

    if (scrollDistance > 100) {
        navbar.addClass('scroll');
    } else {
        navbar.removeClass('scroll');
    }
});

$('.navbar-trg').click(function () {
    $('.navbar-backdrop,.navbar-mobile .navbar-nav').toggleClass('open')
});

$('.navbar-backdrop,.close-nav').click(function () {
    $('.navbar-backdrop,.navbar-mobile .navbar-nav').removeClass('open')
});

$('.upup').click(function () {
    $('html, body').animate({
        scrollTop: 0
    }, 0);
    return false;
});

// BOOTSTRAP
$('.btn:disabled,.btn.disabled').wrap('<div style="cursor:not-allowed"></div>');
$('.modal').addClass('fade');
$('.modal-content').before('<div class="modal-dismiss" data-dismiss="modal"></div>');
$('[data-toggle="tooltip"]').tooltip();

$('[data-toggle="popover"]').popover({
    html: true
});

$('.dropdown-menu').on('click', function (e) {
    if ($(e.target).attr('data-toggle') === 'modal') {
        return;
    }
    e.stopPropagation();
}).find('.close').on('click', function (e) {
    e.preventDefault();
    $('.dropdown').removeClass('open');
});

// FORM
$('textarea,input').attr('spellcheck', 'false').attr('autocomplete', 'off');
$('select.form-control').wrap('<div class="form-control-select"></div>');
$('.form-control-select:has(select[multiple])').addClass('multiple');
$('.floating-label .form-control').attr('placeholder', ' ');
$('.floating-label .form-control + label').removeAttr('for');
$('[class*="form-option-"] input').after('<span class="custom-mark"></span>');
$('[class*="form-option-"] label:has(input:disabled)').attr('style', 'cursor:not-allowed');

$('.space-dash').on('input', function () {
    var text = $(this).val();
    text = text.replace(/\s/g, '-');
    $(this).val(text);
});

$('.form-control-currency').each(function () {
    $(this).on('input', function () {
        var value = $(this).val().replace(/[^\d]/g, '');
        var formattedValue = value.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        $(this).val(formattedValue);
    });
});

$('.input-file input[type="file"]').change(function () {
    var file = this.files[0];
    var fileName = $(this).val().split('\\').pop();
    var parentDiv = $(this).closest('.input-file');
    var placeholderSpan = parentDiv.find('.placeholder > span');
    var browseFileBtn = parentDiv.find('.browse_file');
    var removeFileBtn = parentDiv.find('.remove_file');
    var coverWrapper = parentDiv.find('.cover-wrap');

    placeholderSpan.text(fileName);

    if (fileName !== '') {
        removeFileBtn.removeClass('hidden');
        browseFileBtn.html('<span class="material-symbols">sync</span><span>Change File</span>');

        if (file && file.type.startsWith('image/')) {
            var reader = new FileReader();

            reader.readAsDataURL(file);
            reader.onload = function (e) {
                var imgSrc = e.target.result;
                coverWrapper.removeClass('hidden').html('<img src="' + imgSrc + '" alt="">');
            };
        }
    } else {
        browseFileBtn.html('<span class="material-symbols">upload</span><span>Browse File</span>');
        removeFileBtn.addClass('hidden');
        coverWrapper.addClass('hidden').empty();
    }
});

$('.input-file').on('click', '.browse_file', function () {
    $(this).closest('.input-file').find('input[type="file"]').click();
});

$('.input-file').on('click', '.remove_file', function () {
    var parentDiv = $(this).closest('.input-file');
    var fileInput = parentDiv.find('input[type="file"]');
    fileInput.val('');
    parentDiv.find('.placeholder > span').text('No file chosen ...');
    parentDiv.find('.remove_file').addClass('hidden');
    parentDiv.find('.cover-wrap').addClass('hidden').empty();
    parentDiv.find('.browse_file').html('<span class="material-symbols">upload</span><span>Browse File</span>');
});

$('.input-seek').each(function () {
    var seekInput = $(this).find('input[type="password"]');
    var seekToggle = $(this).find('.btn');

    seekToggle.click(function () {
        var input = seekInput.attr('type');
        if (input === 'password') {
            seekInput.attr('type', 'text');
            seekToggle.find('.material-symbols').text('visibility_off');
        } else {
            seekInput.attr('type', 'password');
            seekToggle.find('.material-symbols').text('visibility');
        }
    });
});

$('.floating-label').each(function () {
    var floatingLabel = $(this);
    floatingLabel.find('.form-control').after(floatingLabel.find('label').clone().addClass('clone'));
    floatingLabel.find('label:not([class])').insertAfter(floatingLabel.find('.form-control'));
});

$('.form-underline .floating-label').each(function () {
    $(this).find('label:last-child').after('<div class="highlight"></div>');
});

$('.form-control.auto-height').on('input', function () {
    this.style.height = 'auto';
    this.style.height = (this.scrollHeight > 48 ? this.scrollHeight : 48) + 'px';
}).trigger('input');

$('.validate-input').on('input', function () {
    var hasValue = $('.validate-input').filter(function () {
        return this.value.trim() !== '';
    }).length > 0;
    $('.validate-btn').prop('disabled', !hasValue);
});

// COPY TO CLIPBOARD
$('.copyBtn').each(function () {
    var copyBtn = $(this);
    var copyText = copyBtn.attr('data-copy');

    if (!copyText) {
        copyText = copyBtn.text();
        copyBtn.attr('data-copy', copyText);
    }

    if (copyBtn.hasClass('currency')) {
        copyText = copyText.replace(/[^0-9]/g, '');
    }

    copyBtn.attr('title', 'Copied : ' + copyText).tooltip({
        trigger: 'manual'
    }).click(function () {
        copyBtn.tooltip('toggle');
        navigator.clipboard.writeText(copyText).then(function () {
            setTimeout(function () {
                copyBtn.tooltip('hide');
            }, 1500);
        });
    });
});

$('[data-toggle="copySelector"]').each(function () {
    var copyBtn = $(this);
    var copyTarget = $($(this).attr('data-target'));
    var copyText = copyTarget.text();

    if (copyText) {
        copyTarget.attr('title', 'Copied').tooltip({
            trigger: 'manual'
        });

        copyBtn.click(function () {
            copyTarget.tooltip('toggle');
            navigator.clipboard.writeText(copyText).then(function () {
                setTimeout(function () {
                    copyTarget.tooltip('hide');
                }, 1500);
            });
        });
    }
});