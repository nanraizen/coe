$('a[href="#"]').click(function (e) {
    e.preventDefault();
});

$('.btn:disabled,.btn.disabled').wrap('<div style="cursor:not-allowed"></div>');

$(function () {
    $('img').each(function () {
        var $img = $(this);
        var filename = $img.attr('src').split('/').pop().split('.')[0];
        var altText = $img.attr('alt');

        if (!altText) {
            $img.attr('alt', filename);
        }
    });
});


// NAVBAR & FOOTER
$(function () {
    $(window).scroll(function () {
        var scrollDistance = $(window).scrollTop();
        var navbar = $('.navbar-fixed');

        if (scrollDistance > 100) {
            navbar.addClass('scroll');
        } else {
            navbar.removeClass('scroll');
        }
    });
    $('.fik-upup').click(function () {
        $('html, body').animate({
            scrollTop: 0
        }, 0);
        return false;
    });
});


// BOOTSTRAP
$('.modal-dialog .modal-content').before('<div class="modal-dismiss" data-dismiss="modal"></div>');
$('[data-toggle="tooltip"]').tooltip();

$('[data-toggle="popover"]').popover({
    html: true
});

$('.dropdown-menu').on('click', function (e) {
    if ($(e.target).attr('data-toggle') === 'modal') {
        return;
    }
    e.stopPropagation();
}).find('.close').on('click', function (e) {
    e.preventDefault();
    $('.dropdown').removeClass('open');
});

$(function () {
    $('.dropdown').on('shown.bs.dropdown', function () {
        setTimeout(function () {
            $('.navbar-menu .signin #user_username').focus();
        }, 100);
    });
    $('.btn[data-toggle="collapse"]').on('click', function () {
        $(this).toggleClass('active');
    });
});

$(function () {
    $('.breadcrumb > li.active span').tooltip({
        title: 'You are Here.',
        placement: 'top',
        trigger: 'hover'
    });
});


// FORM
$('textarea,input').attr('spellcheck', 'false').attr('autocomplete', 'off');
$('select.form-control').wrap('<div class="select-form-control"></div>');
$('.select-form-control:has(select[multiple])').addClass('multiple');
$('.form-group.has-feedback .form-control').wrap('<div class="feedback-form-control"></div>');
$('.checkbox input,.radio input,.checkbox-toggle label input').after('<span class="custom-mark"></span>');
$('.checkbox:has(input:disabled),.radio:has(input:disabled)').addClass('disabled');
$('.floating-label .form-control').attr('placeholder', ' ');
$('.floating-label .form-control + label').removeAttr('for');


// TEXTAREA
$(function () {
    $('.form-control.auto-height').on('input', function () {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight > 48 ? this.scrollHeight : 48) + 'px';
    }).trigger('input');

    $('.validate-input').on('input', function () {
        var hasValue = $('.validate-input').filter(function () {
            return this.value.trim() !== '';
        }).length > 0;
        $('.validate-btn').prop('disabled', !hasValue);
    });
});


// FLOATING LABEL
$(function () {
    $('.floating-label').each(function () {
        var labels = $(this).find('label');

        labels.each(function (index) {
            var originalLabel = $(this);
            var clonedLabel = originalLabel.clone();

            originalLabel.after(clonedLabel);

            var label = $(this);
            var input = $(this).siblings('.form-control');

            if (index === 0) {
                var labelText = label.text();
                label.empty().append('<span>' + labelText + '</span>');
            }

            label.insertAfter(input);
        });
    });
});


// QUICK SEARCH
$(function () {
    var qsWrapper = $('.qsWrapper');
    var qsRows = $('.qsRows');
    var qsEmpty = $('<div class="alert alert-warning qsEmpty">Tidak ada hasil pencarian dengan kata kunci yang dimaksud.</div>');

    qsWrapper.find(qsRows).after(qsEmpty);
    qsWrapper.find('table').has(qsRows).after(qsEmpty);

    function qsFn(e) {
        qsRows.find('.qsHidden').each(function () {
            $(this).replaceWith($(this).contents());
        });

        qsRows.children().each(function () {
            if ($(this).text().toLowerCase().indexOf(e) === -1) {
                $(this).wrap('<div class="qsHidden"></div>');
            }
        });

        if (qsRows.children(':visible').length === 0) {
            qsEmpty.show();
        } else {
            qsEmpty.hide();
        }
    }

    qsWrapper.on('keyup', '.qsInput', function () {
        var qsInput = $(this).val();
        qsFn(qsInput);
    });
});


// COPY TO CLIPBOARD
$(function () {
    $('.copyBtn').each(function () {
        var copyBtn = $(this);
        var copyText = copyBtn.attr('data-copy');

        if (!copyText) {
            copyText = copyBtn.text();
            copyBtn.attr('data-copy', copyText);
        }

        if (copyBtn.hasClass('currency')) {
            copyText = copyText.replace(/[^0-9]/g, '');
        }

        copyBtn.attr('title', 'Copied : ' + copyText).tooltip({
            trigger: 'manual'
        }).click(function () {
            copyBtn.tooltip('toggle');
            navigator.clipboard.writeText(copyText).then(function () {
                setTimeout(function () {
                    copyBtn.tooltip('hide');
                }, 1500);
            });
        });
    });

    $('.copySelector').each(function () {
        var copySelector = $(this);
        var copyText = copySelector.find('.copySelectorText').text();

        if (copyText) {
            var copySelectorText = copySelector.find('.copySelectorText');
            var copyBtn = copySelector.find('.copySelectorBtn');

            copySelectorText.attr('title', 'Copied').tooltip({
                trigger: 'manual'
            });

            copyBtn.click(function () {
                copySelectorText.tooltip('toggle');
                navigator.clipboard.writeText(copyText).then(function () {
                    setTimeout(function () {
                        copySelectorText.tooltip('hide');
                    }, 1500);
                });
            });
        }
    });
});


// SHORT NUMBER
$(function () {
    var transactionValue = $('.short-num');
    var value = parseFloat(transactionValue.text());
    var formattedValue = formatNumber(value);

    transactionValue.text(formattedValue);

    function formatNumber(value) {
        if (value >= 1000000) {
            return (value / 1000000).toFixed(1) + ' jt';
        } else if (value >= 1000) {
            return (value / 1000).toFixed(1) + ' rb';
        } else {
            return value.toString();
        }
    }
});


// RATING INFO
$(function () {
    $('.course--child').each(function () {
        var rating = parseFloat($(this).find('.rating b').text());
        var starIcon = Math.round(rating * 2) / 2;

        for (var i = 5; i >= 1; i--) {
            var star;

            if (i <= starIcon) {
                star = $('<span class="material-symbols-outlined fill">star</span>');
            } else if (i - 0.5 === starIcon) {
                star = $('<span class="material-symbols-outlined">star_half</span>');
            } else {
                star = $('<span class="material-symbols-outlined">star_border</span>');
            }

            $(this).find('.rating').prepend(star);
        }
    });

    var courseChildCount = $('.course--child').length;

    if (courseChildCount > 3) {
        $('section').has('ul.pagination').removeAttr('style');
    }
});


// DASHBOARD
$(function () {
    $('.sidebar--menu ul li ul li.active').parent('ul').slideToggle(200).parent().addClass('active open');

    $('.sidebar--menu ul li').click(function () {
        $(this).toggleClass('open')
        $(this).siblings().removeClass('open');
        $(this).find('ul').slideToggle(200);
        $(this).siblings().find('ul').slideUp(200);
    });

    $('.sidebar--menu ul li').click(function (e) {
        e.stopPropagation();
    });
});


// YEAR
$(function () {
    var thisYear = new Date().getFullYear();
    var releaseYear = parseInt($('#release_year').text());

    if (releaseYear === thisYear) {
        $('#this_year').hide();
    } else {
        $('#this_year').text(' - ' + thisYear);
    }
});


// ACTIVE MENU
$('.navbar-menu ul > li > a').each(function () {
    if ($(this).prop('href') == window.location.href) {
        $(this).addClass('active');
        $(this).parents('li').addClass('active');
    }
});